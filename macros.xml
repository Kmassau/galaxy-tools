<?xml version="1.0"?>
<macros>
  <xml name="requirements">
    <requirements>
      <requirement type="package" version="2.7">python</requirement>
      <yield/>
    </requirements>
  </xml>
  <token name="@DATA_DIR@">/apollo-data</token>
  <token name="@EXT_URL@">
\$GALAXY_WEBAPOLLO_EXT_URL
  </token>
  <token name="@URL@">
\$GALAXY_WEBAPOLLO_URL
  </token>
  <token name="@USER_AUTH_REMOTE@">
\$GALAXY_WEBAPOLLO_URL
$__user_email__
""
--remote_user REMOTE_USER
  </token>
  <token name="@ADMIN_AUTH@">
\$GALAXY_WEBAPOLLO_URL
galaxy@gmod.org
\$GALAXY_WEBAPOLLO_PASSWORD
  </token>

  <token name="@ORG_OR_GUESS@">
<![CDATA[
#if $org_source.source_select == "auto_json":
    \$(cat $org_source.org_file | grep 'commonName' | head -n 1| sed 's/.*: "//g;s/".*//g')
#else
    "${org_source.organism_cn}"
#end if
]]>
  </token>
  <token name="@CN_OR_GUESS@">
<![CDATA[
#if $cn_source.source_select == "auto":
    "${cn_source.organism_cn}"
    #if str($cn_source.cn_file) != "None":
        \$(cat $cn_source.cn_file | grep '^>' | sed 's/\s.*//g;s/>//g')
    #end if
#elif $cn_source.source_select == "auto_json":
    \$(cat $cn_source.cn_file | grep 'commonName' | head -n 1| sed 's/.*: "//g;s/".*//g')
#else
    "${cn_source.organism_cn}"
    #for $item in $cn_source.refseqs:
        "${item.refseq}"
    #end for
#end if
]]>
  </token>
  <xml name="org_or_guess">
    <conditional name="org_source">
        <param name="source_select" type="select" label="Organism Common Name Source">
            <option value="direct">Direct Entry</option>
            <option value="auto_json">Autodetect from Apollo JSON</option>
        </param>
        <when value="direct">
            <param name="organism_cn" type="text" label="Organism Common Name" />
        </when>
        <when value="auto_json">
            <param name="cn_file" type="data" format="json" label="Apollo Organism File" help="Will only fetch first organism" />
        </when>
    </conditional>
  </xml>
  <xml name="cn_or_guess">
    <conditional name="cn_source">
        <param name="source_select" type="select" label="Organism Common Name Source">
            <option value="direct">Direct Entry</option>
            <option value="auto">Autodetect from Fasta</option>
            <option value="auto_json">Autodetect from Apollo JSON</option>
        </param>
        <when value="auto">
            <param name="organism_cn" type="text" label="Organism Common Name" />
            <param name="cn_file" type="data" format="fasta" label="Reference sequence(s)" optional="true"/>
        </when>
        <when value="auto_json">
            <param name="cn_file" type="data" format="json" label="Apollo Organism File" help="Will only fetch first organism" />
        </when>
        <when value="direct">
            <param name="organism_cn" type="text" label="Organism Common Name" />

            <repeat name="refseqs">
                <param name="refseq" type="text" label="Reference sequence(s)" />
            </repeat>
        </when>
    </conditional>
  </xml>

  <xml name="citations">
      <citations>
      </citations>
  </xml>
  <xml name="gff3_input">
    <param label="GFF3 Annotations" name="gff3_data" type="data" format="gff3"/>
  </xml>
  <token name="@GENOME_SELECTOR_PRE@">
#if $reference_genome.reference_genome_source == 'history':
    ln -s $reference_genome.genome_fasta genomeref.fa;
#end if
  </token>
  <token name="@GENOME_SELECTOR@">
#if $reference_genome.reference_genome_source == 'cached':
    "${reference_genome.fasta_indexes.fields.path}"
#elif $reference_genome.reference_genome_source == 'history':
    genomeref.fa
#end if
  </token>
<token name="@REFERENCES@">
<![CDATA[
------

**Citation**

If you use this tool in Galaxy, please cite:
Eric Rasche (2016), `Galaxy wrapper <https://github.com/TAMU-CPT/galaxy-webapollo>`_
]]>
    </token>
</macros>
