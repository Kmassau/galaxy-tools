<?xml version="1.0"?>
<tool id="jbrowse_to_existing" name="Add Organism to existing JBrowse" version="3.0">
  <description>will create the organism if it doesn't exist, and update otherwise</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="aggressive"><![CDATA[
    #if $unique_id:
        #set dataset_name = $unique_id
    #else:
        #set dataset_name = $jbrowse.id
    #end if

    cp -R '${jbrowse.extra_files_path}/data/' "@DATA_DIR@/${dataset_name}"

    &&

    echo -e "[datasets.${dataset_name}]\nurl  = ?data=data/${dataset_name}\nname = ${name}" >> "@DATA_DIR@/datasets.conf"

    &&

    echo -e "[general]\ndataset_id  = ${dataset_name}" >> "@DATA_DIR@/${dataset_name}/tracks.conf"
  ]]></command>
  <inputs>
    <param name="jbrowse" type="data" format="html" label="JBrowse HTML Output" />
    <param name="name" type="text" label="Display name" optional="False" />
    <param name="unique_id" type="text" label="Unique ID" help="will be used in HTTP links (default=auto generated id)" optional="True">
        <validator type="regex" message="Value must be a not empty string composed by alphanumeric characters and underscores">^\w+$</validator>
    </param>
  </inputs>
  <outputs>
    <data format="json" name="output"/>
  </outputs>
  <help><![CDATA[
**What it does**
Adds an organism to a JBrowse instance. The tool takes the output of a
JBrowse run as that contains all of the necessary information for which
tracks are appropriate for a given analysis.
      ]]></help>
    <expand macro="citations"/>
</tool>
